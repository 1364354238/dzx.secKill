# 优化

## 判断重复抢购

> 抢购时，先从缓存中取订单，取到不为空，则是重复抢购，为空，则开始下订单。


## 减库存

> 将库存加载到Redis中，在Redis中预减库存，然后存入数据库中。


1. 系统初始化，把商品库存数量加载到Redis中
2. 预减库存（可用哈希表记录商品是否为空，减少Redis访问）
3. 把订单信息通过消息队列转发，下订单

## 下单

> 消息队列


## 轮询

> 如果数据库中没有订单，也没发生超买超卖，则订单进入轮询。


## 安全

> 防止脚本抢购


1. 隐藏秒杀接口地址（防止提前秒杀，只有点击按钮才能秒杀）
2. 验证码（隔离脚本，分流）
3. 接口限流（防刷），计数器算法（Redis存用户访问次数，访问频率=访问次数/key生存时间）



